<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div id="main-div">
        <input type="text" placeholder="key"/>
        <input type="text" placeholder="message"/>
        <input type="text" placeholder="code message" disabled/>
    </div>    
</body>
<script>
    // Array das letras normais
    var outerWheel = ['C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O'
    ,'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', 'A', 'B'];
    let c = 'C';
    let asciiC = c.charCodeAt(0);

    var message  = "Im not finished yet";
    message = message.toUpperCase();
    
    // Array das letras codificadas
    var innerWheel = [];    
    
    // Gera a "roda" interna (Array interno)
    for (let i = 0; i < outerWheel.length; i++) {
        var obj = {"letter": 'ç', "pos": 25}
        obj.letter = outerWheel[i];
        obj.pos = i;
        innerWheel[i] = obj;
    }

    let index = "G", keyword = "EA"
    let arrayMessage = [];
    let arrayKeyword = [];
    let currentIndexArrays = 0;
    let indexKeyword = 0;

    // Dada a nossa mensagem, vamos repetir a keyword para ocupar todo o espaço da mensagem
    for (let i = 0; i < message.length; i++) {
        let charMessage = message.charAt(i);
        if (charMessage != ' ') {
            arrayMessage[currentIndexArrays] = charMessage;
            arrayKeyword[currentIndexArrays] = keyword.charAt(indexKeyword);
            indexKeyword++;
            currentIndexArrays++;
            if (indexKeyword >= keyword.length) {
                indexKeyword = 0;
            }
        }
    }

    let codedMessage = [];
    let ascii1 = index.charCodeAt(0);
    // Agora vamos ter que realizar a conversão utilizando o index e a keyword
    for (let i = 0; i < arrayKeyword.length; i++) {
        /* Realiza a rotação da "roda" interna */
        rotation(index, arrayKeyword[i]);
        console.log("inner wheel\n");
        for (let k = 0; k < innerWheel.length; k++) {
            console.log(innerWheel[k]);
        }

        /* Realiza a conversão da mensagem para os caracteres codificados */
        // queremos saber em qual posição do array está esse char da mensagem
        let asciiCharMsg = arrayMessage[i].charCodeAt(0);
        let diffAscii = asciiCharMsg - asciiC;

        let position = diffAscii;
        if (diffAscii < 0) {
            position = 25 + (diffAscii + 1);
        }
        let codedChar = innerWheel[position].letter;
        codedMessage[i] = codedChar; 
    }

    console.log("Coded message: \n");
    for (let i = 0; i < codedMessage.length; i++) {
        console.log(codedMessage[i]);
    }

    /* REALIZAR A DECODIFICAÇÃO DA MENSAGEM */
    let decodedMessage = [];
    for (let i = 0; i < codedMessage.length; i++) {
        // Temos que realizar a rotação para o index e também o char respectivo da keyword
        rotation(index, arrayKeyword[i]);

        // Toda vez que realizar a rotação, precisamos saber qual letra está na posição 0 do array interno
        // pois com isso iremos conseguir encontrar a posição da letra codificada, dentro do array interno.
        // Sabendo a posição da letra codificada no array interno, basta pegar a letra na mesma posição 
        // no array externo
        let charPosition0 = innerWheel[0].letter;
        let ascii1 = innerWheel[0].letter.charCodeAt(0);
        let ascii2 = codedMessage[i].charCodeAt(0);

        let diff = ascii2 - ascii1;
        let position = diff;
        if (diff < 0) {
            position = 25 + (diff + 1);
        }
        let decodedChar = outerWheel[position];
        decodedMessage[i] = decodedChar;
    }

    console.log("Decoded message: \n");
    let indexDecodedMsg = 0;
    for (let i = 0; i < message.length; i++) {
        if (message.charAt(i) != ' ') {
            console.log(decodedMessage[indexDecodedMsg]);
            indexDecodedMsg++;
        } else {
            console.log(' ');
        }
    }


    function rotation(char1, char2) {
        /* Realiza a rotação da "roda" interna */
        let ascii1 = char1.charCodeAt(0);
        let ascii2 = char2.charCodeAt(0);
        let diff = ascii1 - ascii2;
        console.log("Diff: " + diff);

        for (let i = 0; i < outerWheel.length; i++) {
            var obj = {"letter": 'A', pos: '25'};
            obj.letter = outerWheel[i];
            obj.pos = i;

            let nextPos = (i + diff);
            if (nextPos > 25) {
                nextPos = (nextPos % 25) - 1;
            } else if (nextPos < 0) {
                nextPos = 25 + (nextPos + 1);
            }
            innerWheel[nextPos] = obj;
        }
    }
</script>
</html>